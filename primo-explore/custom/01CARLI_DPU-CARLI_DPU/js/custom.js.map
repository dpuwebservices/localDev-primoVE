{"version":3,"sources":["node_modules/browser-pack/_prelude.js","primo-explore/custom/01CARLI_DPU-CARLI_DPU/js/main.js"],"names":["r","e","n","t","o","i","f","c","require","u","a","Error","code","p","exports","call","length","1","module","app","angular","component","bindings","parentCtrl","controller","this","isCollapsed","lc","document","createElement","type","async","src","location","protocol","s","getElementsByTagName","parentNode","insertBefore","template","constant","config","$sceDelegateProvider","hathiTrustBaseUrl","urlWhitelist","resourceUrlWhitelist","push","factory","$http","$q","lookup","ids","hathiTrustLookupUrl","join","jsonp","cache","jsonpCallbackParam","then","resp","data","resolve","svc","findRecord","bibData","recordId","Object","keys","records","recordURL","catch","console","error","findFullViewRecord","fullTextUrl","result","j","items","item","usRightsString","toLowerCase","fromRecord","hathiTrust","self","$onInit","msg","hideOnline","isOnline","hideIfJournal","isJournal","updateHathiTrustAvailability","isOclcNum","value","match","prmSearchResultAvailabilityLine","pnx","addata","format","indexOf","delivery","GetIt1","some","g","links","l","isLinktoOnline","deliveryCategory","hathiTrustIds","oclcid","filter","map","id","replace","ignoreCopyright","res","link","fullTextLink","entityId"],"mappings":"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","file":"custom.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()","\r\n(function(){\r\n    \"use strict\";\r\n     \r\n    /****************************************************************************************************/\r\n  \r\n        /*In case of CENTRAL_PACKAGE - comment out the below line to replace the other module definition*/\r\n  \r\n    var app = angular.module('viewCustom', ['angularLoad', 'hathiTrustAvailability']);\r\n  \r\n    /****************************************************************************************************/\r\n    // Code from UIC to initially collapse I-Share libraries\r\n    app.component(\"prmAlmaOtherMembersAfter\", {\r\n        bindings: {\r\n          parentCtrl: \"<\",\r\n        },\r\n        controller: [\r\n          function () {\r\n            var ctrl = this;\r\n            ctrl.parentCtrl.isCollapsed = true;\r\n          },\r\n        ],\r\n      });\r\n\r\n          \r\n      // Adds the chat button\r\n    (function() {\r\n        var lc = document.createElement('script'); lc.type = 'text/javascript'; lc.async = 'true';\r\n        lc.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'v2.libanswers.com/load_chat.php?hash=5b6ccf0890ace526e5703d7f2baf7e4f';\r\n        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(lc, s);\r\n    })();    \r\n  \r\n     \r\n    /****************************************************************************************************/\r\n  \r\n        /*In case of CENTRAL_PACKAGE - comment out the below line to replace the other module definition*/\r\n  \r\n        /*var app = angular.module('centralCustom', ['angularLoad']);\r\n  \r\n    /****************************************************************************************************/\r\n    \r\n  /* HathiTrust Availability add-on shared by CARLI 9/3/2020\r\n  * adapted from https://github.com/UMNLibraries/primo-explore-hathitrust-availability\r\n  *\r\n  * NOTE: Be sure to add 'hathiTrustAvailability' to the\r\n  *       angular.module() function at the top of custom.js,\r\n  *       i.e., add it to the array that also includes 'angularLoad', e.g.,\r\n  *\r\n  * var app = angular.module('viewCustom', ['angularLoad', 'hathiTrustAvailability']);\r\n  *\r\n  * There are 4 different available options you can set for \"template\" below:\r\n  * (See https://github.com/UMNLibraries/primo-explore-hathitrust-availability for more details)\r\n  * E.g.,\r\n  * app.component('prmSearchResultAvailabilityLineAfter', {\r\n  *   template: '<hathi-trust-availability ignore-copyright=\"true\"></hathi-trust-availability>'\r\n  * });\r\n  * 1. To display full-text links to any HathiTrust record, regardless of copyright status, use the ignore-copyright attribute\r\n  * <hathi-trust-availability ignore-copyright=\"true\"></hathi-trust-availability>\r\n  * 2. To avoid looking for full-text availability on records for which you already have an online copy, use hide-online attribute\r\n  * <hathi-trust-availability hide-online=\"true\"></hathi-trust-availability>\r\n  * 3. To suppress full-text links for journals, use hide-if-journal\r\n  * <hathi-trust-availability hide-if-journal=\"true\"></hathi-trust-availability>\r\n  * 4. If you're a HathiTrust partner institution and you want the availability links to use HathiTrust's automatic login, add your SAML IdP's entity ID with:\r\n  * <hathi-trust-availability \r\n  *     ignore-copyright=\"true\" \r\n  *     entity-id=\"https://shibboleth.umich.edu/idp/shibboleth\"></hathi-trust-availability>\r\n  */\r\n  app.component('prmSearchResultAvailabilityLineAfter', {\r\n  template: '<hathi-trust-availability ignore-copyright=\"true\" entity-id=\"https://shib.is.depaul.edu/idp/shibboleth\"></hathi-trust-availability>'\r\n  });\r\n  \r\n  angular.module('hathiTrustAvailability', []).constant('hathiTrustBaseUrl', 'https://catalog.hathitrust.org/api/volumes/brief/json/').config(['$sceDelegateProvider', 'hathiTrustBaseUrl', function ($sceDelegateProvider, hathiTrustBaseUrl) {\r\n  var urlWhitelist = $sceDelegateProvider.resourceUrlWhitelist();\r\n  urlWhitelist.push(hathiTrustBaseUrl + '**');\r\n  $sceDelegateProvider.resourceUrlWhitelist(urlWhitelist);\r\n  }]).factory('hathiTrust', ['$http', '$q', 'hathiTrustBaseUrl', function ($http, $q, hathiTrustBaseUrl) {\r\n  var svc = {};\r\n  \r\n  var lookup = function lookup(ids) {\r\n    if (ids.length) {\r\n      var hathiTrustLookupUrl = hathiTrustBaseUrl + ids.join('|');\r\n      return $http.jsonp(hathiTrustLookupUrl, {\r\n        cache: true,\r\n        jsonpCallbackParam: 'callback'\r\n      }).then(function (resp) {\r\n        return resp.data;\r\n      });\r\n    } else {\r\n      return $q.resolve(null);\r\n    }\r\n  };\r\n  \r\n  // find a HT record URL for a given list of identifiers (regardless of copyright status)\r\n  svc.findRecord = function (ids) {\r\n    return lookup(ids).then(function (bibData) {\r\n      for (var i = 0; i < ids.length; i++) {\r\n        var recordId = Object.keys(bibData[ids[i]].records)[0];\r\n        if (recordId) {\r\n          return $q.resolve(bibData[ids[i]].records[recordId].recordURL);\r\n        }\r\n      }\r\n      return $q.resolve(null);\r\n    }).catch(function (e) {\r\n      console.error(e);\r\n    });\r\n  };\r\n  \r\n  // find a public-domain HT record URL for a given list of identifiers\r\n  svc.findFullViewRecord = function (ids) {\r\n    var handleResponse = function handleResponse(bibData) {\r\n      var fullTextUrl = null;\r\n      for (var i = 0; !fullTextUrl && i < ids.length; i++) {\r\n        var result = bibData[ids[i]];\r\n        for (var j = 0; j < result.items.length; j++) {\r\n          var item = result.items[j];\r\n          if (item.usRightsString.toLowerCase() === 'full view') {\r\n            fullTextUrl = result.records[item.fromRecord].recordURL;\r\n            break;\r\n          }\r\n        }\r\n      }\r\n      return $q.resolve(fullTextUrl);\r\n    };\r\n    return lookup(ids).then(handleResponse).catch(function (e) {\r\n      console.error(e);\r\n    });\r\n  };\r\n  \r\n  return svc;\r\n  }]).controller('hathiTrustAvailabilityController', ['hathiTrust', function (hathiTrust) {\r\n  var self = this;\r\n  \r\n  self.$onInit = function () {\r\n    if (!self.msg) self.msg = 'Full Text Available at HathiTrust';\r\n  \r\n    // prevent appearance/request iff 'hide-online'\r\n    if (self.hideOnline && isOnline()) {\r\n      return;\r\n    }\r\n  \r\n    // prevent appearance/request iff 'hide-if-journal'\r\n    if (self.hideIfJournal && isJournal()) {\r\n      return;\r\n    }\r\n  \r\n    // look for full text at HathiTrust\r\n    updateHathiTrustAvailability();\r\n  };\r\n  \r\n  var isJournal = function isJournal() {\r\n    var format = self.prmSearchResultAvailabilityLine.result.pnx.addata.format[0];\r\n    return !(format.toLowerCase().indexOf('journal') == -1); // format.includes(\"Journal\")\r\n  };\r\n  \r\n  var isOnline = function isOnline() {\r\n    var delivery = self.prmSearchResultAvailabilityLine.result.delivery || [];\r\n    if (!delivery.GetIt1) return delivery.deliveryCategory.indexOf('Alma-E') !== -1;\r\n    return self.prmSearchResultAvailabilityLine.result.delivery.GetIt1.some(function (g) {\r\n      return g.links.some(function (l) {\r\n        return l.isLinktoOnline;\r\n      });\r\n    });\r\n  };\r\n  \r\n  var formatLink = function formatLink(link) {\r\n    return self.entityId ? link + '?signon=swle:' + self.entityId : link;\r\n  };\r\n  \r\n  var isOclcNum = function isOclcNum(value) {\r\n    return value.match(/^(\\(ocolc\\))?\\d+$/i);\r\n  };\r\n  \r\n  var updateHathiTrustAvailability = function updateHathiTrustAvailability() {\r\n    var hathiTrustIds = (self.prmSearchResultAvailabilityLine.result.pnx.addata.oclcid || []).filter(isOclcNum).map(function (id) {\r\n      return 'oclc:' + id.toLowerCase().replace('(ocolc)', '');\r\n    });\r\n    hathiTrust[self.ignoreCopyright ? 'findRecord' : 'findFullViewRecord'](hathiTrustIds).then(function (res) {\r\n      if (res) self.fullTextLink = formatLink(res);\r\n    });\r\n  };\r\n  }]).component('hathiTrustAvailability', {\r\n  require: {\r\n    prmSearchResultAvailabilityLine: '^prmSearchResultAvailabilityLine'\r\n  },\r\n  bindings: {\r\n    entityId: '@',\r\n    ignoreCopyright: '<',\r\n    hideIfJournal: '<',\r\n    hideOnline: '<',\r\n    msg: '@?'\r\n  },\r\n  controller: 'hathiTrustAvailabilityController',\r\n  template: '<span ng-if=\"$ctrl.fullTextLink\" class=\"umnHathiTrustLink\">\\\r\n                <md-icon alt=\"HathiTrust Logo\">\\\r\n                  <svg version=\"1.1\" id=\"Layer_1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" x=\"0px\" y=\"0px\" width=\"100%\" height=\"100%\" viewBox=\"0 0 16 16\" enable-background=\"new 0 0 16 16\" xml:space=\"preserve\">  <image id=\"image0\" width=\"16\" height=\"16\" x=\"0\" y=\"0\"\\\r\n                  xlink:href=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAABGdBTUEAALGPC/xhBQAAACBjSFJN\\\r\n                  AAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAACNFBMVEXuegXvegTsewTveArw\\\r\n                  eQjuegftegfweQXsegXweQbtegnsegvxeQbvegbuegbvegbveQbtegfuegbvegXveQbvegbsfAzt\\\r\n                  plfnsmfpq1/wplPuegXvqFrrq1znr2Ptok/sewvueQfuegbtegbrgRfxyJPlsXDmlTznnk/rn03q\\\r\n                  pVnomkjnlkDnsGnvwobsfhPveQXteQrutHDqpF3qnUnpjS/prmDweQXsewjvrWHsjy7pnkvqqGDv\\\r\n                  t3PregvqhB3uuXjusmzpp13qlz3pfxTskC3uegjsjyvogBfpmkHpqF/us2rttXLrgRjrgBjttXDo\\\r\n                  gx/vtGznjzPtfhHqjCfuewfrjCnwfxLpjC7wtnDogBvssmjpfhLtegjtnEjrtnTmjC/utGrsew7s\\\r\n                  o0zpghnohB/roUrrfRHtsmnlkTbrvH3tnEXtegXvegTveQfqhyHvuXjrrGTpewrsrmXqfRHogRjt\\\r\n                  q2Dqewvqql/wu3vqhyDueQnwegXuegfweQPtegntnUvnt3fvxI7tfhTrfA/vzJvmtXLunEbtegrw\\\r\n                  egTregzskjbsxI/ouoPsqFzniyrz2K3vyZnokDLpewvtnkv30J/w17XsvYXjgBbohR7nplnso1L0\\\r\n                  1Kf40Z/um0LvegXngBnsy5juyJXvsGftrGTnhB/opVHoew7qhB7rzJnnmErkkz3splbqlT3smT3t\\\r\n                  tXPqqV7pjzHvunjrfQ7vewPsfA7uoU3uqlruoEzsfQ/vegf///9WgM4fAAAAFHRSTlOLi4uLi4uL\\\r\n                  i4uLi4uLi4tRUVFRUYI6/KEAAAABYktHRLvUtndMAAAAB3RJTUUH4AkNDgYNB5/9vwAAAQpJREFU\\\r\n                  GNNjYGBkYmZhZWNn5ODk4ubh5WMQERUTl5CUEpWWkZWTV1BUYlBWUVVT19BUUtbS1tHV0zdgMDQy\\\r\n                  NjE1MzRXsrC0sraxtWOwd3B0cnZxlXZz9/D08vbxZfDzDwgMCg4JdQsLj4iMio5hiI2LT0hMSk5J\\\r\n                  TUvPyMzKzmHIzcsvKCwqLiktK6+orKquYZCuratvaGxqbmlta+8QNRBl6JQ26Oru6e3rnzBx0uQ8\\\r\n                  aVGGvJopU6dNn1E8c9bsOXPniYoySM+PXbBw0eIlS5fl1C+PFRFlEBUVXbFy1eo1a9fliQDZYIHY\\\r\n                  9fEbNm7avEUUJiC6ddv2HTt3mSuBBfhBQEBQSEgYzOIHAHtfTe/vX0uvAAAAJXRFWHRkYXRlOmNy\\\r\n                  ZWF0ZQAyMDE2LTA5LTEzVDE0OjA2OjEzLTA1OjAwNMgVqAAAACV0RVh0ZGF0ZTptb2RpZnkAMjAx\\\r\n                  Ni0wOS0xM1QxNDowNjoxMy0wNTowMEWVrRQAAAAASUVORK5CYII=\" />\\\r\n                  </svg> \\\r\n                </md-icon>\\\r\n                <a target=\"_blank\" ng-href=\"{{$ctrl.fullTextLink}}\">\\\r\n                {{ ::$ctrl.msg }}\\\r\n                  <prm-icon external-link=\"\" icon-type=\"svg\" svg-icon-set=\"primo-ui\" icon-definition=\"open-in-new\"></prm-icon>\\\r\n                </a>\\\r\n              </span>'\r\n  });\r\n  \r\n  /* END HathiTrust Availability add-on */ \r\n       \r\n  \r\n  })();"]}